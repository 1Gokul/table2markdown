'use strict';$(document).ready(function(){function u(){$("#input-table tbody>tr>th").each(function(a){$(this).html(++a)})}function w(){$("#input-table > thead > tr").find("th").each(function(a,b){0==a?$(this).replaceWith('<th scope="col" style="width:10px">#</th>'):$(this).replaceWith('<th scope="col">'+a+"</th>")})}function B(){var a="";$("#input-table").find("thead tr").find("th").each(function(b,f){a="buttons"==$(this).attr("name")?a+colEdicHtml:0==b?a+'<th scope="row"></th>':a+"<td></td>"});return a}
function h(a="none"){if("none"!=c)$(c).addClass("selectedCell"),d=c.cellIndex,g=c.parentNode.rowIndex;else if("col"===a){var b=!1;$("#input-table > tbody > tr").each(function(f,n){f+1===g&&$(n).find("td").each(function(e,k){if((e===d||e+1===d||e+2===d)&&$(k).length)return c=k,h(),b=!0,!1});if(!0===b)return!1})}else"row"===a&&(b=!1,$("#input-table > tbody > tr").each(function(f,n){f!==g&&f+1!==g&&f+2!==g||$(n).find("td").each(function(e,k){if(e+1===d&&$(k).length)return c=k,h(),b=!0,!1});if(!0===b)return!1}));
$(".column-menu > button,.row-menu > button,.text-menu > button").removeAttr("disabled");$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")}function v(){$(c).removeClass("selectedCell");c="none";$(".column-menu > button,.row-menu > button,.text-menu > button").attr("disabled","disabled","disabled");g=d=0;$(".keyboard-nav > div").not(".movement-key, .undo-key, .redo-key").addClass("grey-out")}function p(a){console.log("You were at: ["+g+"]["+d+"]");if("none"===c)d=g=1;else{if(Q(a))return console.log("No can do! Going out of bounds there."),
!1;"up"===a?--g:"left"===a?--d:"down"===a?g+=1:"right"===a&&(d+=1)}console.log("You have gone to: ["+g+"]["+d+"]");var b=!1;$("#input-table > tbody > tr").each(function(f,n){f+1===g&&$(n).find("td").each(function(e,k){if(e+1===d){if($(k).length)return v(),c=k,b=!0,!1;console.log("No element")}});if(!0===b)return!1});h()}function Q(a){var b=$("#input-table > tbody > tr").length,f=$("#input-table > thead > tr > th").length-1;if("up"===a)return 1===g;if("left"===a)return 1===d;if("down"===a)return g===
b;if("right"===a)return d===f}function C(){rowData=B();$("<tr>"+rowData+"</tr>").insertBefore(c.closest("tr"));u();h();q()}function x(){rowData=B();0>=$("#input-table > tbody > tr").length?($($("#input-table").find("tbody")).append("<tr>"+rowData+"</tr>"),$(".bElim, .bEdit, .bAddRowUp").show(200,"linear"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!1),p("down")):$("<tr>"+rowData+"</tr>").insertAfter(c.closest("tr"));
u();h();q()}function D(){$("#input-table thead tr th").each(function(a,b){a==d&&$('<th scope="col">'+a+"</th>").insertBefore(b)});$("#input-table tbody tr").each(function(){$(this).find("td").each(function(a,b){if(a+1==d)return $("<td></td>").insertBefore(b),!1})});w();h();q()}function y(){1===$("#input-table > thead > tr > th").length?($("#input-table > thead > tr").append('<th scope="col">1</th>'),$("#input-table tbody tr").each(function(){$(this).append("<td></td>")}),$(".bAddColumnLeft, .bDeleteColumn").show(200,
"linear"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!1),p("right")):($("#input-table thead tr th").each(function(a,b){a==d&&$('<th scope="col">'+a+"</th>").insertAfter(b)}),$("#input-table tbody tr").each(function(){$(this).find("td").each(function(a,b){if(a+1==d)return $("<td></td>").insertAfter(b),!1})}),h());w();q()}function E(){r=!0;$(".generate-table-button > button, .text-menu > button, .column-menu > button").attr("disabled",
"disabled","disabled");$(".keyboard-nav > div").hide(200,"linear");$(".editing-key").show(200,"linear");rowEdit(c);$(c).find("input").focus()}function F(){rowAcep(c);$(".generate-table-button > button, .text-menu > button, .column-menu > button").removeAttr("disabled");$(".keyboard-nav > div").show(200,"linear");$(".editing-key").hide(200,"linear");r=!1;q()}function z(){var a=[];$(".generate-table-button > button").html('Converting...<i class="fas fa-circle-notch fa-spin ml-2"></i>');$("#input-table > tbody > tr").each(function(){var e=
[];$(this).find("td").each(function(){var k=$(this).html();""===k?e.push(" "):e.push(k)});a.push(e)});var b=JSON.stringify(a),f="none",n="none";"true"===shouldLoadTable?(f="edit-csv",n=fileID):f="insert";$.ajax({type:"POST",url:Flask.url_for("insert_and_convert",{operation:f,file_id:n}),data:b,processData:!1,contentType:"application/json",dataType:"json"}).done(e=>{$(".generate-table-button > button").html("Generate");A=!0;t=e.resultFileID;$("#result-container").remove();$("#result-rule").remove();
e='<hr id="result-rule" size="2" width="100%" align="center" noshade><div id="result-container" class="result-container"><h1>Your converted table</h1><div class="card result-box mt-5"><div class="grid-child result-text darkerbg">'+(e.resultTable+"</div>");e+='<div class="grid-child links"><a href="'+Flask.url_for("get_table",{view_type:"raw",file_id:t})+'"target="_blank" class="btn submit-download-link">Raw<br>(Press <b>I</b>)</a>';e+='<a href="'+Flask.url_for("get_table",{view_type:"download",file_id:t})+
'"target="_blank" class="btn submit-download-link">Download<br>(Press <b>O</b>)</a></div></div></div>';$(e).insertAfter("#input-table-card");window.scrollTo(0,$("hr").offset().top)}).fail(e=>{console.log("Error during file convert: "+e)})}function G(){var a=$(c).html();""==a||a.includes("<del>")||(a="<del>"+a+"</del>",$(c).html(a))}function H(){var a=$(c).html();""==a||a.includes("<i>")||(a="<i>"+a+"</i>",$(c).html(a));q()}function I(){var a=$(c).html();""==a||a.includes("<b>")||(a="<b>"+a+"</b>",
$(c).html(a));q()}function J(){rowElim(c);0>=$("#input-table > tbody > tr").length?(v(),$(".bElim, .bEdit, .bAddRowUp").hide(200,"linear"),$(".row-menu > button").removeAttr("disabled"),$(".generate-table-button > button").prop("disabled",!0),K("T","Add Row Below"),$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")):h("row");q()}function L(){rowCancel(c);$(".generate-table-button > button, .text-menu > button, .column-menu > button").removeAttr("disabled");$(".keyboard-nav > div").show(200,
"linear");$(".editing-key").hide(200,"linear");r=!1}function K(a,b){$(".keyboard-nav .key-description").each(function(){-1===b.indexOf($(this).text())&&$(this).hide(200,"linear")});$(".keyboard-nav .key-name").each(function(){-1===a.indexOf($(this).text())&&$(this).hide(200,"linear")})}function M(){$("#input-table thead tr th").each(function(a,b){a==d&&b.remove()});$("#input-table tbody tr").each(function(){$(this).find("td").each(function(a,b){if(a+1==d)return b.remove(),!1})});1===$("#input-table > thead > tr > th").length?
(v(),$(".bAddColumnLeft, .bDeleteColumn").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!0),$(".column-menu > button").removeAttr("disabled"),K("X","Add Col Right"),$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")):(c="none",h("col"));w()}function N(){A&&(window.location.href=Flask.url_for("get_table",{view_type:"download",file_id:t}))}function O(){A&&(window.location.href=Flask.url_for("get_table",{view_type:"raw",file_id:t}))}function q(){10===
l.length&&l.shift();var a=l.length-m-1;for(let b=0;b<a;b++)l.pop();a=$("#input-table").html();l.push(a);m=l.length-1;$(".undo").prop("disabled")&&($(".undo").prop("disabled",!1),$(".undo-key").removeClass("grey-out"));$(".redo").prop("disabled",!0);$(".redo-key").addClass("grey-out")}function P(){$("#input-table > tbody > tr > td").each(function(a,b){if($(b).hasClass("selectedCell"))return v(),c=b,!1});h()}var c="none",d=0,g=0,r=!1,A=!1,t="none";p();$(".bAcep, .bCanc, .editing-key").hide(200,"linear");
$(".undo, .redo").prop("disabled",!0);$(".redo-key, .undo-key").addClass("grey-out");var l=[$("#input-table").html()],m=0;$("#input-table").SetEditable({onAdd:function(){u()},onDelete:function(){c="none";u()}});$(document).on("click","#input-table > tbody > tr > td",function(a){r||c==a.target||($(c).removeClass("selectedCell"),c=a.target,h())});$(document).on("click",".undo",function(){0<m&&($("#input-table").html("").append(l[m-1]),--m,0===m&&($(".undo").prop("disabled",!0),$(".undo-key").addClass("grey-out")),
$(".redo").prop("disabled")&&($(".redo").prop("disabled",!1),$(".redo-key").removeClass("grey-out")));P()});$(document).on("click",".redo",function(){m<l.length-1&&($("#input-table").html("").append(l[m+1]),m+=1,m===l.length-1&&($(".redo").prop("disabled",!0),$(".redo-key").addClass("grey-out")),$(".undo").prop("disabled")&&($(".undo-key").addClass("grey-out"),$(".undo").prop("disabled",!1)));P()});$(document).on("click",".bAddRowUp",C);$(document).on("click",".bAddRowDown",x);$(document).on("click",
".bAddColumnLeft",D);$(document).on("click",".bAddColumnRight",y);$(document).on("click",".bDeleteColumn",M);$(document).on("click",".bEdit",E);$(document).on("click",".bAcep",F);$(document).on("click",".bCanc",L);$(document).on("click",".bElim",J);$(document).on("click",".make-bold",I);$(document).on("click",".make-italic",H);$(document).on("click",".make-strikethrough",G);$(document).on("click",".bGenerateTable",z);$(this).keypress(function(a){if(r)switch(a.code){case "KeyJ":F();break;case "KeyK":L()}else if("none"!=
c)switch(a.code){case "KeyW":p("up");break;case "KeyA":p("left");break;case "KeyS":p("down");break;case "KeyD":p("right");break;case "KeyU":p("right");break;case "KeyB":I();break;case "KeyN":H();break;case "KeyM":G();break;case "KeyZ":D();break;case "KeyC":M();break;case "KeyE":E();break;case "KeyR":C();break;case "KeyY":J();break;case "KeyG":z();break;case "KeyX":y();break;case "KeyT":x();break;case "KeyI":O();break;case "KeyO":N()}else switch(a.code){case "KeyG":z();break;case "KeyX":y();break;
case "KeyT":x();break;case "KeyI":O();break;case "KeyO":N()}})});