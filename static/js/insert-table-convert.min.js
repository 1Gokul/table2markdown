$(document).ready(function(){let e="none",t=0,n=0,o=!1,a=!1,i="none",r=!1;f(),$(".bAcep, .bCanc, .editing-key").hide(200,"linear"),$(".undo, .redo").prop("disabled",!0),$(".redo-key, .undo-key").addClass("grey-out");var d=[$("#input-table").html()],l=0;function u(){$("#input-table tbody>tr>th").each(function(e){$(this).html(++e)})}function c(){$("#input-table > thead > tr").find("th").each(function(e,t){0==e?$(this).replaceWith('<th scope="col" style="width:10px">#</th>'):$(this).replaceWith('<th scope="col">'+e+"</th>")})}function s(){var e=$("#input-table").find("thead tr").find("th"),t="";return e.each(function(e,n){"buttons"==$(this).attr("name")?t+=colEdicHtml:t+=0==e?'<th scope="row"></th>':"<td></td>"}),t}function b(o="none"){if("none"!=e)$(e).addClass("selectedCell"),t=e.cellIndex,n=e.parentNode.rowIndex;else if("col"===o){var a=!1;$("#input-table > tbody > tr").each(function(o,i){if(o+1===n&&$(i).find("td").each(function(n,o){if((n===t||n+1===t||n+2===t)&&$(o).length)return e=o,b(),a=!0,!1}),!0===a)return!1})}else if("row"===o){a=!1;$("#input-table > tbody > tr").each(function(o,i){if(o!==n&&o+1!==n&&o+2!==n||$(i).find("td").each(function(n,o){if(n+1===t&&$(o).length)return e=o,b(),a=!0,!1}),!0===a)return!1})}$(".column-menu > button,.row-menu > button,.text-menu > button").removeAttr("disabled"),$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")}function h(){$(e).removeClass("selectedCell"),e="none",$(".column-menu > button,.row-menu > button,.text-menu > button").attr("disabled","disabled","disabled"),t=0,n=0,$(".keyboard-nav > div").not(".movement-key, .undo-key, .redo-key").addClass("grey-out")}function f(o){if(console.log("You were at: ["+n+"]["+t+"]"),"none"===e)n=1,t=1;else{if(function(e){var o=$("#input-table > tbody > tr").length,a=$("#input-table > thead > tr > th").length-1;if("up"===e)return 1===n;if("left"===e)return 1===t;if("down"===e)return n===o;if("right"===e)return t===a}(o))return console.log("No can do! Going out of bounds there."),!1;"up"===o?n-=1:"left"===o?t-=1:"down"===o?n+=1:"right"===o&&(t+=1)}console.log("You have gone to: ["+n+"]["+t+"]");var a=!1;$("#input-table > tbody > tr").each(function(o,i){if(o+1===n&&$(i).find("td").each(function(n,o){if(n+1===t){if($(o).length)return h(),e=o,a=!0,!1;console.log("No element")}}),!0===a)return!1}),b()}function p(){rowData=s(),$("<tr>"+rowData+"</tr>").insertBefore(e.closest("tr")),u(),b(),I()}function y(){rowData=s(),$("#input-table > tbody > tr").length<=0?($($("#input-table").find("tbody")).append("<tr>"+rowData+"</tr>"),$(".bElim, .bEdit, .bAddRowUp").show(200,"linear"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!1),f("down")):$("<tr>"+rowData+"</tr>").insertAfter(e.closest("tr")),u(),b(),I()}function k(){$("#input-table thead tr th").each(function(e,n){e==t&&$('<th scope="col">'+e+"</th>").insertBefore(n)}),$("#input-table tbody tr").each(function(){$(this).find("td").each(function(e,n){if(e+1==t)return $("<td></td>").insertBefore(n),!1})}),c(),b(),I()}function m(){1===$("#input-table > thead > tr > th").length?($("#input-table > thead > tr").append('<th scope="col">1</th>'),$("#input-table tbody tr").each(function(){$(this).append("<td></td>")}),$(".bAddColumnLeft, .bDeleteColumn").show(200,"linear"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!1),f("right")):($("#input-table thead tr th").each(function(e,n){e==t&&$('<th scope="col">'+e+"</th>").insertAfter(n)}),$("#input-table tbody tr").each(function(){$(this).find("td").each(function(e,n){if(e+1==t)return $("<td></td>").insertAfter(n),!1})}),b()),c(),I()}function v(){o=!0,$(".generate-table-button > button, .text-menu > button, .column-menu > button").attr("disabled","disabled","disabled"),$(".keyboard-nav > div").hide(200,"linear"),$(".editing-key").show(200,"linear"),rowEdit(e),$(e).find("input").focus()}function g(){rowAcep(e),$(".generate-table-button > button, .text-menu > button, .column-menu > button").removeAttr("disabled"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),o=!1,I()}function w(){var e=new Array;$(".generate-table-button > button").html('Converting...<i class="fas fa-circle-notch fa-spin ml-2"></i>'),$("#input-table > tbody > tr").each(function(){var t=new Array;$(this).find("td").each(function(){var e=$(this).html();""===e?t.push(" "):t.push(e)}),e.push(t)});var t=JSON.stringify(e),n="none",o="none";"true"===shouldLoadTable?(n="edit-csv",o=fileID):n="insert",$.ajax({type:"POST",url:Flask.url_for("insert_and_convert",{operation:n,file_id:o}),data:t,processData:!1,contentType:"application/json",dataType:"json"}).done(e=>{$(".generate-table-button > button").html("Generate"),function(e){a=!0,i=e.resultFileID,$("#result-container").remove(),$("#result-rule").remove();var t='<hr id="result-rule" size="2" width="100%" align="center" noshade>';t+='<div id="result-container" class="result-container"><h1>Your converted table</h1>',t+='<div class="card result-box mt-5"><div class="grid-child result-text darkerbg">'+e.resultTable+"</div>",t+='<div class="grid-child links"><a href="'+Flask.url_for("get_table",{view_type:"raw",file_id:i})+'"target="_blank" class="btn submit-download-link">Raw<br>(Press <kbd>I</kbd>)</a>',t+='<a href="'+Flask.url_for("get_table",{view_type:"download",file_id:i})+'"target="_blank" class="btn submit-download-link">Download<br>(Press <kbd>O</kbd>)</a></div></div></div>',$(t).insertAfter("#input-table-card"),window.scrollTo(0,$("hr").offset().top)}(e)}).fail(e=>{console.log("Error during file convert: "+e)})}function C(){var t=$(e).html();if(""!=t&&!t.includes("<del>")){var n="<del>"+t+"</del>";$(e).html(n)}}function A(){var t=$(e).html();if(""!=t&&!t.includes("<i>")){var n="<i>"+t+"</i>";$(e).html(n)}I()}function K(){var t=$(e).html();if(""!=t&&!t.includes("<b>")){var n="<b>"+t+"</b>";$(e).html(n)}I()}function _(){rowElim(e),$("#input-table > tbody > tr").length<=0?(h(),$(".bElim, .bEdit, .bAddRowUp").hide(200,"linear"),$(".row-menu > button").removeAttr("disabled"),$(".generate-table-button > button").prop("disabled",!0),D("T","Add Row Below"),$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")):b("row"),I()}function x(){rowCancel(e),$(".generate-table-button > button, .text-menu > button, .column-menu > button").removeAttr("disabled"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),o=!1}function D(e,t){$(".keyboard-nav .key-description").each(function(){-1===t.indexOf($(this).text())&&$(this).hide(200,"linear")}),$(".keyboard-nav .key-name").each(function(){-1===e.indexOf($(this).text())&&$(this).hide(200,"linear")})}function E(){$("#input-table thead tr th").each(function(e,n){e==t&&n.remove()}),$("#input-table tbody tr").each(function(){$(this).find("td").each(function(e,n){if(e+1==t)return n.remove(),!1})}),1===$("#input-table > thead > tr > th").length?(h(),$(".bAddColumnLeft, .bDeleteColumn").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!0),$(".column-menu > button").removeAttr("disabled"),D("X","Add Col Right"),$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")):(e="none",b("col")),c()}function T(){a&&(window.location.href=Flask.url_for("get_table",{view_type:"download",file_id:i}))}function R(){a&&(window.location.href=Flask.url_for("get_table",{view_type:"raw",file_id:i}))}function I(){10===d.length&&d.shift();let e=d.length-l-1;for(let t=0;t<e;t++)d.pop();var t=$("#input-table").html();d.push(t),l=d.length-1,$(".undo").prop("disabled")&&($(".undo").prop("disabled",!1),$(".undo-key").removeClass("grey-out")),$(".redo").prop("disabled",!0),$(".redo-key").addClass("grey-out")}function O(){$("#input-table > tbody > tr > td").each(function(t,n){if($(n).hasClass("selectedCell"))return h(),e=n,!1}),b()}$("#input-table").SetEditable({onAdd:function(){u()},onDelete:function(){e="none",u()}}),$(document).on("click","#input-table > tbody > tr > td",function(t){o||e==t.target||($(e).removeClass("selectedCell"),e=t.target,b())}),$(document).on("click",".undo",function(){l>0&&($("#input-table").html("").append(d[l-1]),0===(l-=1)&&($(".undo").prop("disabled",!0),$(".undo-key").addClass("grey-out")),$(".redo").prop("disabled")&&($(".redo").prop("disabled",!1),$(".redo-key").removeClass("grey-out")));O()}),$(document).on("click",".redo",function(){l<d.length-1&&($("#input-table").html("").append(d[l+1]),(l+=1)===d.length-1&&($(".redo").prop("disabled",!0),$(".redo-key").addClass("grey-out")),$(".undo").prop("disabled")&&($(".undo-key").addClass("grey-out"),$(".undo").prop("disabled",!1)));O()}),$(document).on("click",".bAddRowUp",p),$(document).on("click",".bAddRowDown",y),$(document).on("click",".bAddColumnLeft",k),$(document).on("click",".bAddColumnRight",m),$(document).on("click",".bDeleteColumn",E),$(document).on("click",".bEdit",v),$(document).on("click",".bAcep",g),$(document).on("click",".bCanc",x),$(document).on("click",".bElim",_),$(document).on("click",".make-bold",K),$(document).on("click",".make-italic",A),$(document).on("click",".make-strikethrough",C),$(document).on("click",".bGenerateTable",w),$(document).keydown(function(e){e.ctrlKey&&(r=!0)}).keyup(function(e){e.ctrlKey&&(r=!1)}),$(document).keydown(function(t){if(o)switch(t.code){case"KeyQ":r&&g();break;case"Escape":x()}else if("none"!=e)switch(t.code){case"KeyW":f("up");break;case"KeyA":f("left");break;case"KeyS":f("down");break;case"KeyD":case"KeyU":f("right");break;case"KeyB":K();break;case"KeyN":A();break;case"KeyM":C();break;case"KeyZ":k();break;case"KeyC":E();break;case"KeyQ":r&&v();break;case"KeyR":p();break;case"KeyY":_();break;case"KeyG":w();break;case"KeyX":m();break;case"KeyT":y();break;case"KeyI":R();break;case"KeyO":T()}else switch(t.code){case"KeyG":w();break;case"KeyX":m();break;case"KeyT":y();break;case"KeyI":R();break;case"KeyO":T()}})});